<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EMOlink - Analyse tes Ã©motions</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#6366f1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="EMOlink">
    <link rel="apple-touch-icon" href="/assets/icon-192.png">
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <span class="logo-icon">ğŸ§ </span>
                <h1>EMOlink</h1>
            </div>
            <div class="header-buttons">
                <button id="friendsBtn" class="btn-secondary">
                    ğŸ‘¥ Amis
                </button>
                <button id="journalBtn" class="btn-secondary">
                    ğŸ“– Journal
                </button>
                <button id="themeToggle" class="btn-icon" aria-label="Changer le thÃ¨me">
                    ğŸŒ™
                </button>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <main class="container">
        <!-- Section d'analyse -->
        <section class="analysis-section">
            <div class="card">
                <h2>Comment te sens-tu aujourd'hui ?</h2>
                <p class="subtitle">Exprime-toi librement, je vais analyser tes Ã©motions</p>

                <div class="input-container">
                    <textarea id="emotionText"
                        placeholder="Ã‰cris ici ce que tu ressens, ce qui te prÃ©occupe, tes joies, tes peines..."
                        maxlength="2000"></textarea>
                    <div class="char-counter">
                        <span id="charCount">0</span> / 2000 caractÃ¨res
                    </div>
                </div>

                <div class="suggestions" id="suggestions">
                    <p class="suggestions-title">ğŸ’¡ Suggestions pour enrichir ton texte :</p>
                    <div class="suggestion-tags">
                        <span class="tag">Comment tu te sens physiquement ?</span>
                        <span class="tag">Qu'est-ce qui t'a marquÃ© aujourd'hui ?</span>
                        <span class="tag">Que ressens-tu en ce moment ?</span>
                    </div>
                </div>

                <button id="analyzeBtn" class="btn-primary">
                    <span class="btn-text">Analyser mes Ã©motions</span>
                    <span class="btn-icon">âœ¨</span>
                </button>
            </div>
        </section>

        <!-- Section des rÃ©sultats -->
        <section class="results-section" id="resultsSection">
            <div class="card result-card">
                <div class="result-header">
                    <h2>Ton profil Ã©motionnel</h2>
                    <div class="result-actions">
                        <button id="shareBtn" class="btn-secondary">ğŸ‘¥ Partager</button>
                        <button id="saveBtn" class="btn-save">ğŸ’¾ Sauvegarder</button>
                    </div>
                </div>

                <!-- Ã‰motion dominante -->
                <div class="dominant-emotion" id="dominantEmotion">
                    <div class="emotion-icon" id="emotionIcon">ğŸ˜Š</div>
                    <h3 id="emotionName">Joie</h3>
                    <p class="emotion-message" id="emotionMessage">Tu rayonnes de positivitÃ© !</p>
                    <div class="intensity-badge" id="intensityBadge">IntensitÃ© forte</div>
                </div>

                <!-- Graphique des Ã©motions -->
                <div class="emotions-chart" id="emotionsChart">
                    <!-- Les barres seront gÃ©nÃ©rÃ©es dynamiquement -->
                </div>

                <!-- Message empathique -->
                <div class="empathy-message" id="empathyMessage">
                    <div class="empathy-icon">ğŸ’­</div>
                    <p id="empathyText"></p>
                </div>
            </div>
        </section>

        <!-- Section du journal -->
        <section class="journal-section" id="journalSection">
            <div class="card journal-card">
                <div class="journal-header">
                    <h2>ğŸ“– Ton Journal Ã‰motionnel</h2>
                    <button id="closeJournal" class="btn-close">âœ•</button>
                </div>

                <div class="journal-stats">
                    <div class="stat-item">
                        <span class="stat-number" id="totalEntries">0</span>
                        <span class="stat-label">Analyses</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="dominantMood">-</span>
                        <span class="stat-label">Humeur dominante</span>
                    </div>
                </div>

                <div class="journal-filters">
                    <button class="filter-btn active" data-filter="all">Toutes</button>
                    <button class="filter-btn" data-filter="joie">ğŸ˜Š Joie</button>
                    <button class="filter-btn" data-filter="tristesse">ğŸ˜¢ Tristesse</button>
                    <button class="filter-btn" data-filter="colÃ¨re">ğŸ˜  ColÃ¨re</button>
                    <button class="filter-btn" data-filter="stress">ğŸ˜° Stress</button>
                </div>

                <div class="journal-entries" id="journalEntries">
                    <div class="empty-journal">
                        <span class="empty-icon">ğŸ“</span>
                        <p>Ton journal est vide</p>
                        <p class="empty-subtitle">Commence par analyser tes Ã©motions !</p>
                    </div>
                </div>

                <button id="clearJournal" class="btn-danger">
                    ğŸ—‘ï¸ Tout effacer
                </button>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <p>EMOlink - Comprends tes Ã©motions, prends soin de toi ğŸ’™</p>
    </footer>

    <!-- Section Amis -->
    <section class="friends-section" id="friendsSection">
        <div class="card friends-card">
            <div class="friends-header">
                <h2>ğŸ‘¥ Mes Amis</h2>
                <button id="closeFriends" class="btn-close">âœ•</button>
            </div>

            <!-- Tabs Navigation -->
            <div class="friends-tabs">
                <button class="tab-btn active" data-tab="my-friends">Mes Amis</button>
                <button class="tab-btn" data-tab="add-friend">Ajouter</button>
                <button class="tab-btn" data-tab="requests">
                    Demandes <span class="badge" id="requestsBadge">0</span>
                </button>
                <button class="tab-btn" data-tab="profile">Profil</button>
            </div>

            <!-- Tab: Mes Amis -->
            <div class="tab-content active" id="tab-my-friends">
                <div class="friends-stats-mini">
                    <div class="stat-mini">
                        <span class="stat-icon">ğŸ‘¥</span>
                        <span class="stat-value" id="friendsCount">0</span>
                        <span class="stat-text">amis</span>
                    </div>
                    <div class="stat-mini">
                        <span class="stat-icon">â­</span>
                        <span class="stat-value" id="favoritesCount">0</span>
                        <span class="stat-text">favoris</span>
                    </div>
                    <div class="stat-mini">
                        <span class="stat-icon">ğŸ’š</span>
                        <span class="stat-value" id="activeCount">0</span>
                        <span class="stat-text">actifs</span>
                    </div>
                </div>

                <div class="friends-list" id="friendsList">
                    <!-- Liste dynamique -->
                </div>
            </div>

            <!-- Tab: Ajouter un ami -->
            <div class="tab-content" id="tab-add-friend">
                <div class="add-friend-container">
                    <h3>Ajouter un ami</h3>
                    <p class="subtitle">Entre le code ami de la personne</p>

                    <div class="input-group">
                        <input type="text" id="friendCodeInput" placeholder="CODE1234" maxlength="8"
                            class="friend-code-input" />
                        <button id="sendRequestBtn" class="btn-primary">
                            Envoyer la demande
                        </button>
                    </div>

                    <div class="demo-section">
                        <p class="demo-text">ğŸ® Mode dÃ©mo : Ajouter des amis fictifs</p>
                        <button id="addDemoFriendsBtn" class="btn-secondary">
                            Ajouter 5 amis de dÃ©mo
                        </button>
                    </div>
                </div>
            </div>

            <!-- Tab: Demandes d'amis -->
            <div class="tab-content" id="tab-requests">
                <h3>Demandes d'amis</h3>
                <div class="requests-list" id="requestsList">
                    <div class="empty-state">
                        <span class="empty-icon">ğŸ“­</span>
                        <p>Aucune demande en attente</p>
                    </div>
                </div>
            </div>

            <!-- Tab: Mon Profil -->
            <div class="tab-content" id="tab-profile">
                <div class="profile-container">
                    <h3>Mon Profil</h3>

                    <div class="profile-avatar-section">
                        <div class="profile-avatar-wrapper">
                            <div class="profile-avatar" id="profileAvatar">ğŸ˜Š</div>
                            <img class="profile-photo" id="profilePhoto" alt="Photo de profil" style="display: none;">
                            <button class="avatar-edit-btn" id="editAvatarBtn" title="Changer la photo">
                                ğŸ“·
                            </button>
                        </div>
                        <input type="file" id="photoInput" accept="image/*" style="display: none;" />
                        <div class="avatar-options">
                            <button id="uploadPhotoBtn" class="btn-secondary btn-sm">
                                ğŸ“· Photo de profil
                            </button>
                            <button id="changeAvatarBtn" class="btn-secondary btn-sm">
                                ğŸ˜Š Emoji avatar
                            </button>
                            <button id="removePhotoBtn" class="btn-secondary btn-sm" style="display: none;">
                                ğŸ—‘ï¸ Supprimer photo
                            </button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label for="usernameInput">Nom d'utilisateur</label>
                        <input type="text" id="usernameInput" placeholder="Ton pseudo" maxlength="20"
                            class="text-input" />
                    </div>

                    <div class="friend-code-display">
                        <label>Ton code ami</label>
                        <div class="code-box">
                            <span class="friend-code" id="myFriendCode">--------</span>
                            <button id="copyCodeBtn" class="btn-icon btn-sm" title="Copier">
                                ğŸ“‹
                            </button>
                        </div>
                        <p class="help-text">Partage ce code pour que d'autres puissent t'ajouter</p>
                    </div>

                    <div class="share-preferences">
                        <h4>PrÃ©fÃ©rences de partage</h4>

                        <label class="checkbox-label">
                            <input type="checkbox" id="autoShareCheckbox">
                            <span>Partager automatiquement mes analyses</span>
                        </label>

                        <div class="input-group">
                            <label>Niveau de partage par dÃ©faut</label>
                            <select id="shareLevelSelect" class="select-input">
                                <option value="emotion-only">Ã‰motion uniquement</option>
                                <option value="summary">RÃ©sumÃ©</option>
                                <option value="full">Texte complet</option>
                            </select>
                        </div>
                    </div>

                    <button id="saveProfileBtn" class="btn-primary">
                        ğŸ’¾ Sauvegarder le profil
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Modal de dÃ©tails d'un ami -->
    <div class="modal" id="friendDetailsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="friendDetailName">Nom de l'ami</h3>
                <button class="btn-close" id="closeFriendDetails">âœ•</button>
            </div>
            <div class="modal-body" id="friendDetailBody">
                <!-- Contenu dynamique -->
            </div>
        </div>
    </div>

    <!-- Modal de partage -->
    <div class="modal" id="shareModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Partager avec des amis</h3>
                <button class="btn-close" id="closeShareModal">âœ•</button>
            </div>
            <div class="modal-body">
                <p class="subtitle">Choisis avec qui tu veux partager cette analyse</p>

                <div class="share-level-selector">
                    <label>Niveau de partage :</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="shareLevel" value="emotion-only" checked>
                            <span>ğŸ˜Š Ã‰motion uniquement</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="shareLevel" value="summary">
                            <span>ğŸ“ RÃ©sumÃ©</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="shareLevel" value="full">
                            <span>ğŸ“– Texte complet</span>
                        </label>
                    </div>
                </div>

                <div class="friends-checklist" id="shareWithFriends">
                    <!-- Liste dynamique de checkboxes -->
                </div>

                <button id="confirmShareBtn" class="btn-primary">
                    Partager
                </button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <!-- Scripts -->
    <script src="js/emotions.js"></script>
    <script src="js/friends.js"></script>
    <script src="js/firebase-config.js"></script>
    <script src="js/script.js"></script>
    <script src="js/friends-ui.js"></script>
    <script src="js/firebase-integration.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(reg => console.log('âœ… Service Worker enregistrÃ©'))
                    .catch(err => console.log('âŒ Erreur Service Worker:', err));
            });
        }
    </script>
</body>

</html>